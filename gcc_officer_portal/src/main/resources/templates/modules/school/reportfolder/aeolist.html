<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/modules/base/head :: head}">

</head>
<style>
    .clickable-link {
        color: blue;
        text-decoration: underline;
        cursor: pointer;
    }
</style>
<body>
	<div class="wrapper">

		<!-- header top menu Start -->
		<header th:replace="~{fragments/modules/base/header :: header}"></header>
		<!-- header top menu end -->
		<div class="page-wrap">
			<!--=============== Left Menu side Start ================-->
			<div th:replace="~{fragments/modules/base/menu :: menu}"></div>
			<!--=============== Left side End ================-->


			<div class="main-content">
				<div class="container-fluid">
					<div class="page-header mb-2">
						<div class="row align-items-end">
							<div class="col-lg-8">
								<div class="page-header-title">
									<i class="fa fa-list-alt bg-blue"></i>
									<div class="d-inline">
										<h5>Schools Reports</h5>
										<span>Reports based on Student Enrollment in AEO wise</span>
									</div>
								</div>
							</div>
							<div class="col-lg-4">
								<nav class="breadcrumb-container" aria-label="breadcrumb">
									<ol class="breadcrumb">
										<li class="breadcrumb-item"><a href="/gcc/index"><i
												class="ik ik-home"></i></a></li>
										<li class="breadcrumb-item" aria-current="page">School</li>
										<li class="breadcrumb-item" aria-current="page">Student Enroll Report</li>
										<li class="breadcrumb-item active" aria-current="page">AEO Wise</li>
									</ol>
								</nav>
							</div>
						</div>
					</div>
					
					
					<!-- <div class="row mt-4">
						<div class="col-12">
							<div class="card">
								<div class="card-header">
									<span style="font-size: medium;font-weight: bold;">Reports Filters</span>
								</div>
								<div class="card-body">
									
								</div>
							</div>
						</div>
					</div> -->
			
					
					<div class="row mt-4">
									<div class="col-md-12">
										<div class="card">
										<div class="card-header">
											<span style="font-size: medium;font-weight: bold;">AEO List</span>
										</div>
										<div class="card-body">
												<div class="table-responsive">
	
													<table id="ReportDatatable"
														class="table table-striped table-bordered table-hover dataTable"
														role="grid">
														<thead class="thead-dark">
															<tr role="row">
																<th class="text-center">S.No</th>
																<th class="text-center">AEO</th>
																<th class="text-center">Total Schools</th>
																<th class="text-center">Total Students</th>															
																<th class="text-center">Enrolled Students</th>	
																<th class="text-center">Pending Students</th>														
															</tr>
														</thead>
														<tbody>
															
														</tbody>
													</table>
												</div>
										</div>
									 </div>
									</div>
								</div>
					
				</div>

			</div>

			<div id="pageLoader" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.8); z-index: 9999; text-align: center;">
				    <div style="position: relative; top: 50%; transform: translateY(-50%);">
				        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
				            <span class="sr-only">Loading...</span>
				        </div>
				        <!-- Add the 'Please wait' text below the spinner -->
				        <p style="margin-top: 1rem; font-size: 1.2rem; color: #007bff;">Please wait...</p>
				    </div>
				</div>

			<footer th:replace="~{fragments/modules/base/footer :: footer}"></footer>
		</div>
	</div>




	<script th:replace="~{fragments/modules/base/script :: script}"></script>
	<!--  sweet alert -->
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	
	<script type="text/javascript">
	
	 $(document).ready(function() {
		 
		 fetchAEOStudentData();

	      	var table = $('#ReportDatatable').DataTable({
	             dom: 'Bftip',
	             columnDefs: [
	                 { targets: 'no-sort', orderable: false }
	             ],
	             lengthMenu: [
	                 [50, 100, 200, 500, -1],
	                 ['50 rows', '100 rows', '200 rows', 'Show all']
	             ],
	             scrollY: '80vh',
	             scrollX: false,            
	             buttons: [
	                 {
	                     extend: 'pageLength',
	                     className: 'btn btn-warning'
	                 },
	                 {
	                     title: 'Data export',
	                     extend: 'copyHtml5',
	                     text: 'Copy',
	                     className: 'btn btn-secondary',
	                     id: 'copyBtn'
	                 },
	                 {
	                     extend: 'excelHtml5',
	                     text: 'Excel',
	                     className: 'btn btn-secondary',
	                     id: 'excelBtn'
	                 },
	                 {
	                     extend: 'csvHtml5',
	                     text: 'CSV',
	                     className: 'btn btn-secondary',
	                     id: 'csvBtn'
	                 },
	                 {
	                     extend: 'pdfHtml5',
	                     text: 'PDF',
	                     className: 'btn btn-secondary',
	                     id: 'pdfBtn'
	                 }
	             ],
	             fixedHeader: false,
	             autoWidth: false,
	             responsive: false,
	             searching: true,
	             select: false,
	             processing: false
	         });
	      	
	      	$('#ReportDatatable').on('click', '.clickable-link', function () {
	      		const aoeName = $(this).text().trim();
	      	    window.location.href = `/gcc/school/aeoschoolentry/aeoallschools?aoe=${aoeName}`;
	      	    
	      	});
	     	   	     	
	     });
		 
		 
	 
	 function fetchAEOStudentData()
	 {
		  	   
  	   $('#pageLoader').show();
  	   $.ajax({
             type: "GET",
             url: "/gcc/api/gccschool/report/getAEOStudentsCount" ,
             contentType: "application/json",
             success: function (response) {
          	    console.log("API Response:", response);
          	    $('#pageLoader').hide();
          	    if (response.Message === "Success") {
          	        console.log("Details Array:", response.data);
          	        // Ensure details is an array and has at least one entry
          	        if (Array.isArray(response.data) && response.data.length > 0) {
          	        	 let scrollHeight = response.data.length <= 50 ? 'auto' : '80vh';
          	        	
          	            let table = $('#ReportDatatable').DataTable({
          	                destroy: true,
          	              	fixedHeader: false,
          	                searching: true,
          	                autoWidth: true,          	                
          	                paging: true,
          	                info: true,
          	                data: response.data,            	             	
          	                columns: [
          	                    { 
          	                        data: null, 
          	                        render: (data, type, row, meta) => meta.row + 1, 
          	                        className: 'text-center' 
          	                    },
          	                  {
          	                      data: 'aoe',
          	                      defaultContent: '-',
          	                      className: 'text-center',
          	                      render: function (data, type, row, meta) {
          	                          if (!data) return '-';
          	                          return `<span class="clickable-link">${data}</span>`;
          	                      }
          	                  },
          	                    { data: 'school_count', defaultContent: '-', className: 'text-center' },
          	                    { data: 'total_students', defaultContent: '-', className: 'text-center' },
          	                    { data: 'student_registered', defaultContent: '-', className: 'text-center' },
          	                  	{ data: 'pending', defaultContent: '-', className: 'text-center' }
          	                             	                    
          	                      
          	                ],
          	                dom: 'Bfrtip',
          	                buttons: [
 	      		                  {
 	      		                      extend: 'pageLength',
 	      		                      className: 'btn btn-warning'
 	      		                  },
 	      		                  {
 	      		                      title: 'Data export',
 	      		                      extend: 'copyHtml5',
 	      		                      text: 'Copy',
 	      		                      className: 'btn btn-secondary',
 	      		                      id: 'copyBtn'
 	      		                  },
 	      		                  {
 	      		                      extend: 'excelHtml5',
 	      		                      text: 'Excel',
 	      		                      className: 'btn btn-secondary',
 	      		                      id: 'excelBtn'
 	      		                  },
 	      		                  {
 	      		                      extend: 'csvHtml5',
 	      		                      text: 'CSV',
 	      		                      className: 'btn btn-secondary',
 	      		                      id: 'csvBtn'
 	      		                  },
 	      		                  {
 	      		                      extend: 'pdfHtml5',
 	      		                      text: 'PDF',
 	      		                      className: 'btn btn-secondary',
 	      		                      id: 'pdfBtn'
 	      		                  }
 	      		              ],
 	      		             columnDefs: [
 	      		                { targets: 'no-sort', orderable: false }
 	      		            ],
 	      		            lengthMenu: [
 	      		                [50, 100, 200, 500, -1],
 	      		                ['50 rows', '100 rows', '200 rows', 'Show all']
 	      		            ],
 	      		            scrollY: scrollHeight,
 	      		            scrollX: false,   	      		            
 	      		       		responsive: false,
 	                		searching: true
 	      		            });
          	        }
          	        
          	    }
          	    else if (response.Message === "No Data") {
      	        	$('#pageLoader').hide();
      	            Swal.fire({
      	                icon: 'warning',
      	                title: 'No Data',
      	                text: 'No data available.'
      	            });
      	        }           	    
          	    else {
          	    	$('#pageLoader').hide();
          	        Swal.fire({
          	            icon: 'error',
          	            title: 'Error',
          	            text:'Something went wrong!'
          	        });
          	    }
          	},

             error: function (error) {
             	$('#pageLoader').hide();
             	Swal.fire({
  	            icon: 'error',
  	            title: 'Error',
  	            text: 'Something went wrong!'
  	        });
             }
         });
	 }
	
	</script>

</body>
</html>