<!DOCTYPE html>
<html lang="en" dir="">
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/modules/base/head :: head}"></head>
    <body>
    <link rel="stylesheet" type="text/css" href="node_modules/jquery.datetimepicker/jquery.datetimepicker.css">
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <div class="wrapper">
			<!-- header top menu Start -->
			 <header th:replace="~{fragments/modules/base/header :: header}"></header>
			<!-- header top menu end -->

            <div class="page-wrap">
				<!--=============== Left Menu side Start ================-->
				<div th:replace="~{fragments/modules/base/menu :: menu}"></div>
				<!--=============== Left side End ================-->
                <div class="main-content">
                    <div class="container-fluid">
                        <div class="page-header">
                            <div class="row align-items-end">
                                <div class="col-lg-8">
                                    <div class="page-header-title">
                                        <i class="far fa-calendar-plus bg-blue"></i>
                                        <div class="d-inline">
                                            <h5>Add New Event</h5>
                                            <span>Ward Sabha Meeting</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <nav class="breadcrumb-container" aria-label="breadcrumb">
                                        <ol class="breadcrumb">
                                            <li class="breadcrumb-item">
                                                <a href="index"><i class="ik ik-home"></i></a>
                                            </li>
                                            <li class="breadcrumb-item" aria-current="page">Ward Sabha Meeting</li>
                                            <li class="breadcrumb-item active" aria-current="page">Add New Event</li>
                                        </ol>
                                    </nav>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                        	<div class="col-md-2"></div>
							<div class="col-md-8">
                                <div class="card">
									<form class="request-form" id="request-form" onsubmit="return saveRequest();" enctype="multipart/form-data">
	                                    <div class="card-header"><h3>New Event Form</h3></div>
	                               		<div class="card-body" id="card-body">
	                               			<div class="row">
	                               				<div class="col-lg-6">
													<div class="form-group">
			                                            <label for="zone">Select Zone / தேர்வு செய்யும் மண்டலம்</label>
			                                            <!-- <select class="form-control" id="zone" name="zone" style="width: 100%;" data-placeholder="தேர்ந்தெடு.." onchange="get_ward_list(this.value);" required>
															<option value=""></option>
														</select> -->
			                                           <!-- <div class="form-radio" id="petition_type"></div> -->
			                                        </div>
		                                      	</div>
	                                        	<div class="col-lg-6">
			                                        <div class="form-group">
			                                            <label for="ward">Select Ward / தேர்வு செய்யும் வார்டு</label>
			                                            <!-- <select class="form-control" id="ward" name="ward" style="width: 100%;" data-placeholder="தேர்ந்தெடு.." required  onchange="get_councillor_details(this.value);">
															<option value=""></option>
														</select> -->
			                                           <!-- <div class="form-radio" id="petition_type"></div> -->
			                                        </div>
	                                        	</div>
	                                        	
	                               				<div class="col-lg-12">
													<div class="form-group">
			                                            <label for="eventdate">Select Event Date</label>
			                                            <input type="text" class="form-control" name="eventdate" id="eventdate"
                                                       placeholder="Event Date" autocomplete="off" required>
			                                        </div>
		                                      	</div>
	                                        </div>
	                                        <div class="row">
	                               				<div class="col-lg-12">
													<div class="form-group">
								                       <label for="action_san_page1">ஆவணப் பதிவேற்றம் / Document Upload:</label>
													   <input name="event_page1" id="event_page1" class="form-control" type="file" capture="camera"  accept="application/pdf, image/*" required>
													 </div>
			                                    </div>
			                                </div>
											
	                                  	<div class="card-footer text-right">
											<button type="reset" class="btn btn-secondary mr-2" id="resetFormBtn"><i class="ik ik-refresh-cw"></i>Reset</button>
                                        	<button type="submit" class="btn btn-success" id="requestSubmitBtn"><i class="ik ik-save"></i>Save</button>
	                                	</div>
                                	</form>
                                </div>
                            </div>
							<div class="col-md-2"></div>
                        </div>
                    </div>
                </div>
				</div>
                 <footer th:replace="~{fragments/modules/base/footer :: footer}"></footer>
            </div>
           
        </div>
       
        
        <div th:replace="~{fragments/modules/base/app_module_menu_box :: div}"></div>
       	
        <script th:replace="~{fragments/modules/base/script :: script}"></script>
        <script th:replace="~{fragments/modules/ward_sabha/script :: script}"></script>
        
		<script src="node_modules/jquery.datetimepicker/jquery.datetimepicker.full.min.js"></script>
       	<script th:inline="javascript">
			var createdBy = /*[[${LoginUserId}]]*/'';
			var complaintTypeList = "";
			var zoneList="";
			var wardList="";
			
			// Save New petition 
			function saveRequest(){
				// Disable the button to prevent multiple clicks
				form_btn_disable();
				
				var inputElementMobileNo = $('#petitionerMobile');
				var mobileNo = inputElementMobileNo.val();
				var mobileFormatRegex = /^\d{10}$/; //'0000000000';
				inputElementMobileNo.removeClass('is-invalid');
				
				var inputElementComplaintType = $('#complaintType');
				var complaintType = inputElementComplaintType.val();
				
				if (mobileNo !== null) {
					
					// Serialize form data
			        var formData = new FormData($('#request-form')[0]);
			        formData.append('createdBy',createdBy);
			        saveFormData(formData).then(function(response) {
						if(response!="error"){
							// Handle the response
		    		    	Swal.fire({
		        				title: 'New minutes data saved successfully.',
		        				customClass: {
		        			        title: 'swal-title-custom' // Add a custom class for the title
		        			    },
		        				//text: "Error",
		        				icon: 'success',
		        				showCancelButton: false,
		        				confirmButtonColor: '#3085d6',
		        				cancelButtonColor: '#d33',
		        				confirmButtonText: 'Ok',
		        				}).then(function(result) {
		        				if (result.isConfirmed) {
		        					// Reload the current page
		        					//location.reload();
		        					// Navigate to a Ack page
		        					//window.location = "/gcc/ward_sabha/petition-ack/"+response;
		        					window.location = "/gcc/ward_sabha/new_petition";
		        				}
		        			});
						}
						else{
							// Handle the response
							// if response == "error"
		    		    	Swal.fire({
		        				title: 'Failed to save minutes data. Please try again!',
		        				customClass: {
		        			        title: 'swal-title-custom' // Add a custom class for the title
		        			    },
		        				//text: "Error",
		        				icon: 'error',
		        				showCancelButton: false,
		        				confirmButtonColor: '#3085d6',
		        				cancelButtonColor: '#d33',
		        				confirmButtonText: 'Ok',
		        				}).then(function(result) {
		        				if (result.isConfirmed) {
		        					form_btn_enable();
		        				}
		        			});
						}
		    		    
	    		    	
		    	    }).catch(function(error) {
		    		    // Handle errors
		    		    console.error('Error on save petition:', error.message);
		    		    form_btn_enable();
	    			});
				}
				else{
					inputElementMobileNo.addClass('is-invalid');
					form_btn_enable();
				}
				return false;
			}
			
			function saveFormData(formData){
				var apiUrl = '/gcc/api/ward_sabha/savePetition';
			    // Return a Promise
			    return new Promise(function(resolve, reject) {
					$.ajax({
						url: apiUrl,
					    type: 'POST',
					    data: formData,
					    processData: false,
					    contentType: false,
					    success: function(response) {
					        console.log(response);
					        // Handle success response
					        resolve(response);
					    },
					    error: function(xhr, status, error) {
					        console.error('Error:', error);
					        // Handle error response
					        reject(error);
					    }
					});
			    });
			}
			
			function form_btn_enable(){
				$("#resetFormBtn").prop("disabled", false);
				$("#requestSubmitBtn").prop("disabled", false);
				$("#requestSubmitBtn").html('<i class="ik ik-save"></i>Save');
			}
			
			function form_btn_disable(){
				$("#resetFormBtn").prop("disabled", true);
				$("#requestSubmitBtn").prop("disabled", true);
				// Show the loading icon on the button
				$("#requestSubmitBtn").html('<i class="fas fa-spinner fa-spin"></i> Validating your request, please wait...');
			}
			
			$(document).ready(function() {
				// For datetime picker
		        jQuery('#eventdate').datetimepicker({
		            //minTime:'10:00',
		            //maxTime:'18:01',
		            //minDate: 0, // Today
		            //minDate:'-1970/01/2',
		            //maxDate:'+1970/01/2',
		            timepicker: false, // Disable time picker
		            mask: true,
		            disabledWeekDays: [0], //[0,1,2,3,4,5,6] -> 0-Sunday .... 6-saturday
		            //disabledDates:['2023/08/31','2023/08/11','2023/08/12'], // Disable date on holidays
		            format: 'd-m-Y', // Date format (you can change it as per your needs)
		        });
				
				//get_event_data();
				//get_zone_ward_data();
				//get_complaint_type_data();
				//$('#petitionerMobile').mask('0000000000');
			});
		</script>
    </body>
</html>
