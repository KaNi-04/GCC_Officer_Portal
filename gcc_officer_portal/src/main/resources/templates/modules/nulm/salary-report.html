<!DOCTYPE html>
<html lang="en" dir="">
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/modules/base/head :: head}"></head>

<body>
	<div class="wrapper">
		<header th:replace="~{fragments/modules/base/header :: header}"></header>

		<div class="page-wrap">
			<div th:replace="~{fragments/modules/base/menu :: menu}"></div>
			<div class="main-content">
				<div class="container-fluid">
					<div class="page-header">
						<div class="row align-items-end">
							<div class="col-lg-6">
								<div class="page-header-title">
									<i class="ik ik-thumbs-up bg-blue"></i>
									<div class="d-inline">
										<h5>NULM STAFF</h5>
										<span>Salary Report</span>
									</div>
								</div>
							</div>
							<div class="col-lg-6">
								<nav class="breadcrumb-container" aria-label="breadcrumb">
									<ol class="breadcrumb">
										<li class="breadcrumb-item">
											<a href="/index"><i class="ik ik-home"></i></a>
										</li>
										<li class="breadcrumb-item active" aria-current="page">Salary Report</li>
									</ol>
								</nav>
							</div>
						</div>
					</div>

					<hr>

					<!-- Filters Section -->
					<div class="row">
						<div class="col-sm-3">
							<label for="month">Month:</label>
							<select id="month" class="form-control" required>
								<option value="">Select</option>
								<option value="January">January</option>
								<option value="February">February</option>
								<option value="March">March</option>
								<option value="April">April</option>
								<option value="May">May</option>
								<option value="June">June</option>
								<option value="July">July</option>
								<option value="August">August</option>
								<option value="September">September</option>
								<option value="October">October</option>
								<option value="November">November</option>
								<option value="December">December</option>
							</select>
						</div>

						<div class="col-sm-3">
							<label for="year">Year:</label>
							<input type="number" id="year" class="form-control" min="2000" max="2100" required>
						</div>

						<div class="col-sm-3">
							<label for="salaryStatus">Salary Status:</label>
							<select id="salaryStatus" class="form-control">
								<option value="">Select</option>
								<option value="Initiated">Initiated</option>
								<option value="Approved">Approved</option>
							</select>
						</div>

						<div class="col-sm-3">
							<label for="selfhelp">Self Help Group:</label>
							<select id="selfhelp" class="form-control">
								<option value="">Select</option>
								<!-- Group names will be populated here -->
							</select>
						</div>



						<div class="col-sm-3">

							<button class="btn btn-primary mt-4" onclick="fetchSalaryReport()">Get Salary Info</button>
						</div>
					</div>

					<!-- Salary Report Table -->
					<div class="card-block mt-3">
						<table id="salaryreporttable" class="table table-striped table-bordered">
							<thead class="thead-dark">
								<tr>
									<th>S.No</th>
									<th>Employee Id</th>
									<th>Employee Name</th>
									<th>Employee Designation</th>
									<th>Incharge Name</th>
									<th>Incharge Designation</th>
									<th>Self Help Group</th>
									<th>Days Present</th>
									<th>OD</th>
									<th>Total Days for Salary</th>
									<th>Total Days</th>
									<th>Total Days Absent</th>
									<th>Month</th>
									<th>Year</th>
									<th>Salary Amount</th>
									<th>Salary Status</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="salary, i : ${salaryReport}">
									<td th:text="${i.count}">1</td>
									<td th:text="${salary.emp_id}"></td>
									<td th:text="${salary.name}"></td>
									<td th:text="${salary.designation}"></td>
									<td th:text="${salary.incharge_name}"></td>
									<td th:text="${salary.incharge_designation}"></td>
									<td th:text="${salary.group_name}"></td>
									<td th:text="${salary.total_days_present}"></td>
									<td th:text="${salary.total_days_od}"></td>
									<td th:text="${salary.total_days_salary}"></td>
									<td th:text="${salary.total_days}"></td>
									<td th:text="${salary.total_days_absent}"></td>
									<td th:text="${salary.imonth}"></td>
									<td th:text="${salary.iyear}"></td>
									<td th:text="${salary.total_salary}"></td>
									<td th:text="${salary.salary_status}"></td>
								</tr>
							</tbody>
							<tfoot class="thead-dark">
								<tr>
									<th>S.No</th>
									<th>Employee Id</th>
									<th>Employee Name</th>
									<th>Employee Designation</th>
									<th>Incharge Name</th>
									<th>Incharge Designation</th>
									<th>Self Help Group</th>
									<th>Days Present</th>
									<th>OD</th>
									<th>Total Days for Salary</th>
									<th>Total Days</th>
									<th>Total Days Absent</th>
									<th>Month</th>
									<th>Year</th>
									<th>Salary Amount</th>
									<th>Salary Status</th>
								</tr>
							</tfoot>
						</table>
					</div>

				</div>
			</div>

			<footer th:replace="~{fragments/modules/base/footer :: footer}"></footer>
		</div>
	</div>

	<div th:replace="~{fragments/modules/base/script :: script}"></div>

	<script th:inline="javascript">

		function fetchSalaryReport() {
			const month = document.getElementById('month').value;
			const year = document.getElementById('year').value;
			const salaryStatus = document.getElementById('salaryStatus').value;
			const groupName=document.getElementById('selfhelp').value;

			if (month && year) {
				window.location.href = `/gcc/nulm/salary-report?month=${month}&year=${year}&salaryStatus=${salaryStatus}&groupName=${groupName}`;
			} else {
				alert("Please select both month and year.");
			}
		}
		$(document).ready(function () {

			function clearUrlParams() {
				const currentUrl = window.location.href;
				const urlWithoutParams = currentUrl.split('?')[0]; // Remove the query parameters
				window.history.replaceState({}, document.title, urlWithoutParams); // Replace the current URL without params
			}

			// Call this on page load to reset the URL
			clearUrlParams();

			// Initialize DataTable
			var table = $('#salaryreporttable').DataTable({
				dom: 'Bftip',
				columnDefs: [
					{targets: 'no-sort', orderable: false}
				],
				lengthMenu: [
					[50, 100, 200, 500, -1],
					['50 rows', '100 rows', '200 rows', 'Show all']
				],
				scrollY: '50vh',
				fixedColumns: {
					left: 1,
					right: 1
				},
				buttons: [
					{
						extend: 'pageLength',
						className: 'btn btn-warning'
					},
					{
						extend: 'pdfHtml5',
						text: 'PDF',
						className: 'btn btn-secondary',
						id: 'pdfBtn',
						exportOptions: {
                    columns: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]
                },
                orientation: 'landscape', // Change to landscape for more horizontal space
    			pageSize: 'A3', // You can change to A4 or A3 depending on your needs
    			customize: function (doc) {
        		// Custom column widths for better fit
        		//doc.content[1].table.widths = ['2%', '6%', '6%', '6%', '6%', '6%', '6%', '3%', '3%', '3%', '3%', '3%', '3%', '6%', '6%', '6%'];
        
        		// Optional: Adjust font size if needed
        		doc.styles.tableBodyEven.alignment = 'center';
        		doc.styles.tableBodyOdd.alignment = 'center';
    			}
			}
				],
				fixedHeader: true,
				autoWidth: true,
				responsive: true,
				searching: true,
				select: false,
				processing: false
			});


		});
		$(document).ready(function () {
			$.ajax({
				url: '/gcc/api/nulm/selfHelpGroups', // Your API endpoint
				type: 'GET',
				success: function (data) {
					// Clear existing options (if any)
					$('#selfhelp').empty().append('<option value="">Select</option>');

					// Check if data is an array and iterate through it
					if (Array.isArray(data)) {
						let options = '';
						data.forEach(function (group) {
							// Access the correct properties
							options += `<option value="${group.groupName}">${group.groupName}</option>`;
						});
						$('#selfhelp').append(options);
					} else {
						console.error("Data is not an array:", data);
					}
				},
				error: function (xhr, status, error) {
					console.error("Error fetching self-help groups:", error);
				}
			});
		});




	</script>
</body>

</html>