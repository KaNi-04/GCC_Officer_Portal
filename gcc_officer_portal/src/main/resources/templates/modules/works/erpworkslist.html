<!DOCTYPE html>
<html lang="en" dir="">
<html xmlns:th="http://www.thymeleaf.org">
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

<head th:replace="~{fragments/modules/base/head :: head}"></head>
<style>
    .is-invalid {
        border: 2px solid red !important;
        background-color: #ffcccc !important;
    }

    .checkbox-large {
        width: 20px;
        height: 20px;
    }

    .readonly-select {
        pointer-events: none; /* Prevent user interaction */
        background-color: #e9ecef; /* Light grey background (like disabled) */
    }
</style>

<body>
<link rel="stylesheet" type="text/css"
      href="node_modules/jquery.datetimepicker/jquery.datetimepicker.css"/>
<!--[if lt IE 8]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade
    your browser</a> to improve your experience.</p>
<![endif]-->

<div class="wrapper">
    <!-- header top menu Start -->
    <header th:replace="~{fragments/modules/base/header :: header}"></header>
    <!-- header top menu end -->

    <div class="page-wrap">
        <!--=============== Left Menu side Start ================-->
        <div th:replace="~{fragments/modules/base/menu :: menu}"></div>
        <!--=============== Left side End ================-->
        <div class="main-content">
            <div class="container-fluid">
                <div class="page-header">
                    <div class="row align-items-end">
                        <div class="col-lg-8">
                            <div class="page-header-title">
                                <i class="far fa-calendar-plus bg-blue"></i>
                                <div class="d-inline">
                                    <h5>List of Works</h5>
                                    <span>ERP Works list</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <nav class="breadcrumb-container" aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="index"><i
                                            class="ik ik-home"></i></a></li>
                                    <li class="breadcrumb-item" aria-current="page">ERP Works
                                        list
                                    </li>
                                    </li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                </div>
                <hr>

                <div class="col-md-14">
                    <div class="card p-3">
                        <div class="row">
                            <div class="col-md-2">
                                <label for="filterType">Financial year: <font style="color: red"></font></label> 
                                <select class="form-control" id="finYear">
	                                <option value="2025-26" >2025-26</option>
	                                <option value="2024-25" selected>2024-25</option>
	                                <option value="2023-24" >2023-24</option>
	                                <option value="2022-23" >2022-23</option>
	                                <option value="2021-22" >2021-22</option>
	                                <option value="" >All</option>
                            	</select>
                            </div>
                            
                            <div class="col-md-2">
                                <label for="filterType">Order Value: <font style="color: red"></font></label> 
                                <select class="form-control" id="oValue">
								    <option value="max50">Up to 50 Lakhs</option>
								    <option value="50to75">Above 50 Lakhs to 75 Lakhs</option>
								    <option value="75to99">Above 75 Lakhs to 99 Lakhs</option>
								    <option value="min1c" selected>1 Crore and Above</option>
								    <option value="">All</option>
								</select>
                            </div>
                            
                            <div class="col-md-2 d-flex align-items-end gap-2">
                                <button id="submitFilter" class="btn btn-primary" onclick="get_erp_works_data_list()">Submit</button>
                                <button class="btn btn-danger mt-2" onclick="resetpage()"
                                        name="reset" type="reset">Reset
                                </button>
                                <!--<button type="button" class="btn btn-sm btn-success mt-2" name="downloadBtn"
                                        onclick="downloadExcel()">Download Excel</button>-->
                            </div>
                        </div>
                    </div>
                </div>
                <br>
                <div class="row">
                    <div class="card-block">
                    <div id="tableLoading"></div>
                        <div>
                            <table id="worksDatatable"
                                   class="table table-striped table-bordered table-hover"
                                   width="99.5%">
                                <!--			   <button id="exportExcel" class="btn btn-success mb-2">Download Excel</button>
-->
                                <thead class="thead-dark">
                                <tr>
                                    <th>S.No</th>
                                    <th>Estimate No</th>
                                    <th>Estimate Date</th>
                                    <th>Zone</th>
                                    <th>Ward</th>
                                    <th>Department</th>
                                    <th>Category</th>
                                    <th>Sub Category</th>
                                    <th>Project Name</th>
                                   
                                    <th>Estimation Amount</th>
                                    <th>Order Value</th>
                                </tr>
                                </thead>
                                <tbody>
                                
                                </tbody>
                            </table>

                            <!-- Pagination Controls -->
                            <div class="pagination-container">
                                <div
                                        class="d-flex justify-content-between align-items-center my-3">
                                    <span id="entriesInfo" class="text-muted"></span>
                                    <ul id="pagination" class="pagination mb-0"></ul>
                                </div>
                                <ul class="pagination justify-content-center"
                                    style="justify-content: right !important;" id="pagination"></ul>
                            </div>

                        </div>
                    </div>
                </div>

            </div>

            <footer th:replace="~{fragments/modules/base/footer :: footer}"></footer>
        </div>
    </div>
</div>

	<div th:replace="~{fragments/modules/works/modal-box :: div}"></div> 
	
    <div th:replace="~{fragments/modules/base/app_module_menu_box :: div}"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script th:replace="~{fragments/modules/base/script :: script}"></script>
    <script th:replace="~{fragments/modules/works/script :: script}"></script>
    
    <script src="node_modules/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    <script src="node_modules/amcharts3/amcharts/amcharts.js"></script>
    <script src="node_modules/amcharts3/amcharts/serial.js"></script>
    <script src="node_modules/amcharts3/amcharts/themes/light.js"></script>
    <script src="node_modules/jquery.datetimepicker/jquery.datetimepicker.full.min.js"></script>
    <script th:inline="javascript">
        var loginUserID = /*[[${LoginUserId}]]*/'';
        var createdBy = /*[[${LoginUserId}]]*/'';
        
        var loading_text_msg = getLoadingMessage(); // get Random loading message from base/script
        
     	// Loading Div id
    	const loading = $("#tableLoading");
     	
    	// DataTables buttons configuration
        var buttons = [
        	{
				extend: 'pageLength',
				className: 'btn btn-warning'
			},
            {
				title: 'Data export',
                extend: 'copyHtml5',
                text: 'Copy',
                className: 'btn btn-secondary',
                id: 'copyBtn'
            },
            {
                extend: 'excelHtml5',
                text: 'Excel',
                className: 'btn btn-secondary',
                id: 'excelBtn',
                title: 'Works List'
            },
            {
                extend: 'csvHtml5',
                text: 'CSV',
                className: 'btn btn-secondary',
                id: 'csvBtn',
                title: 'Works List'
            },
            {
                extend: 'pdfHtml5',
                text: 'PDF',
                className: 'btn btn-secondary',
                id: 'pdfBtn',
                title: 'Works List'
            },
            {
                extend: 'print',
                text: 'Print',
                className: 'btn btn-secondary',
                id: 'printBtn',
                title: 'Works List',
                exportOptions: {
                    columns: ':visible:not(.no-print)' // Exclude columns with class 'no-print' from print view
                }
            },
            {
				extend: 'colvis',
				className: 'btn btn-warning'
			},
        ];
		
    	
        function call_loading(){
			loading.html(searchinfo("<b>"+loading_text_msg+"</b>"));
		}
		
		function remove_loading(){
			loading.html("");
		}
		
        /* 
        	===============================================================================================
        	===============================================================================================
        */
        
        function form_btn_enable() {
            $("#resetFormBtn").prop("disabled", false);
            $("#requestSubmitBtn").prop("disabled", false);
            $("#requestSubmitBtn").html('<i class="ik ik-save"></i>Save');
        }

        function form_btn_disable() {
            $("#resetFormBtn").prop("disabled", true);
            $("#requestSubmitBtn").prop("disabled", true);
            // Show the loading icon on the button
            $("#requestSubmitBtn").html('<i class="fas fa-spinner fa-spin"></i> Validating your request, please wait...');
        }

        //document.getElementById('fromDate').addEventListener('change', validateEndDate);

        function validateEndDate() {
            const startDate = document.getElementById('fromDate').value;
            const endDateInput = document.getElementById('toDate');

            if (startDate) {
                const startDateObj = new Date(startDate);
                const minEndDateISO = startDateObj.toISOString().split('T')[0];
                endDateInput.setAttribute('min', minEndDateISO);

                // Clear endDate if it's less than startDate
                if (endDateInput.value && new Date(endDateInput.value) < startDateObj) {
                    endDateInput.value = '';
                }
            }
        }

        /*
        =========================================================================================
        */

        
        /* Get works data List */
        function get_erp_works_data_list(){
        	
        	call_loading();
        	
        	var table = $('#worksDatatable').DataTable();
        	table.clear();
        	// Destroy the DataTable before reinitializing
        	table.destroy();
        	
        	
        	get_erp_work_data().then(function(erpWorksDataList) {
    		    // Handle the data list
    		    generate_table(erpWorksDataList);
    		    
    		}).catch(function(error) {
    		    // Handle errors
		        if (error && error.message) {
		            console.error('Error fetching complaint list:', error.message);
		        } else {
		            console.error('An error occurred while fetching complaint list:', error);
		        }
    		});
		}
        
        /* Get Erp works Data */
        async function get_erp_work_data() {
        	var finYear = document.getElementById('finYear').value;
            var oValue = document.getElementById('oValue').value;
            //alert(finYear);
            //alert(oValue);
        	var apiUrl = '/gcc/works/api/estimates/getFilteredERpWorksListByLogin?loginId='+createdBy+'&finYear='+finYear+'&oValue='+oValue;
    	    // Return a Promise
    	    return new Promise(function(resolve, reject) {
    	        $.ajax({
    	            url: apiUrl,
    	            type: 'GET',
    	            dataType: 'json',
    	            success: function(jsonResponse) {
						//alert(jsonResponse);
    	                // Resolve the Promise with the department list
    	                resolve(jsonResponse);
    	            },
    	            error: function(xhr, status, error) {
    	                // Reject the Promise with the error message
    	                reject(error);
    	            }
    	        });
    	    });
        }
        
        /* Call DataTable function */
        function generate_table(data){
        	
        	var table = $('#worksDatatable').DataTable();

        	// Destroy the DataTable before reinitializing
        	table.destroy();

        	// Now, reinitialize the table
        	table = $('#worksDatatable').DataTable({
        	    dom: 'Bftip',
        	    deferRender: true,  // Delays rendering of non-visible rows
        	    columnDefs: [
        	        { targets: 'no-sort', "orderable": false },
        	        { targets: 'no-exportable', "exportable": false }
        	    ],
        	    lengthMenu: [
        	        [50, 100, 200, 500, -1],
        	        ['50 rows', '100 rows', '200 rows', '500 rows', 'Show all']
        	    ],
        	    fixedColumns: {
        	        left: 0,
        	        right: 0
        	    },
        	    buttons: [buttons],
        	    responsive: false,
        	    searching: true,
        	    select: false,
        	    processing: true, // Enables processing indicator
        	});
            
        	// Clearn Table data
        	table.clear();
        	            
        	// Add rows to DataTable
        	var rowNum = 1;
        	$.each(data, function(index, row) {
        	    actionHTML = `<div class="dropdown d-inline-block show">
        	                     <a class="nav-link dropdown-toggle text-warning" href="#" id="moreDropdown" role="button" 
        	                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-animation="true" 
        	                    data-placement="top" data-html="true" title="`+row['estimate_no']+`" >`+row['estimate_no']+`</a>
        	                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="moreDropdown" x-placement="bottom-end">
        	                    	<a class="dropdown-item" href="" onclick="return viewUserWorksSummary('`+row['estid']+`');" data-animation="true" data-toggle="tooltip" data-placement="top" data-html="true" title="View Full Details"><i class="ik ik-printer"></i> View Details</a>
        	                    	<a class="dropdown-item" href="" onclick="return updateUserWorksSummary('`+row['estid']+`');" data-animation="true" data-toggle="tooltip" data-placement="top" data-html="true" title="Update Details"><i class="ik ik-edit"></i> Update Details</a>
        	                    	<!--<a class="dropdown-item" href="" onclick="return updateUserWorksStage('`+row['estid']+`');" data-animation="true" data-toggle="tooltip" data-placement="top" data-html="true" title="Add/Edit Work Stages"><i class="ik ik-edit"></i> Update Work Stages</a>
        	                    	<a class="dropdown-item" href="" onclick="return updateUserWorksListBreakup('`+row['estid']+`');" data-animation="true" data-toggle="tooltip" data-placement="top" data-html="true" title="Add/Edit Work Breakup"><i class="ik ik-edit"></i> Update Work tasks</a>-->
        	                    </div>
        	              </div>`;

        	    table.row.add([
        	        rowNum++,
        	        actionHTML,
        	        convertdate(row['estimate_date']),
        	        row['zone'],
        	        row['ward'],
        	        row['department'],
        	        row['category'],
        	        row['sub_category'],
        	        row['project_name'],
        	        row['estimation_amount'],
        	        row['est_val_with_oh']
        	    ]);
        	});

        	// **Call draw() only once**
        	table.draw(false);
            
            // Enable tooltips for all elements with data-toggle="tooltip"
            $('[data-toggle="tooltip"]').tooltip();
            remove_loading(); // remove Loading 
		}
        
        
        function viewUserWorksSummary(estid){
        	$("#viewWorks").modal({
			    backdrop: 'static',
			    keyboard: false
			}); // Show Modal Box
			
			var url = '/gcc/works/user-view-works-details-modal?estid='+estid;
			$.ajax({
			    url: url,
			    type: 'GET',
			    dataType: 'html',
			    success: function(data) {
					$('#viewWorksTitle').html("Works Details");
			      	$('#viewWorksBoxBody').html(data); // Inject content into modal body
			    },
			    error: function(xhr, status, error) {
			      console.error("Error loading URL:", error);
			      // Handle error, display a message, etc.
			    }
			  });
			
			return false;
		}
        
        function updateUserWorksSummary(estid){
        	$("#viewWorks").modal({
			    backdrop: 'static',
			    keyboard: false
			}); // Show Modal Box
			
			var url = '/gcc/works/user-update-works-details-modal?estid='+estid;
			$.ajax({
			    url: url,
			    type: 'GET',
			    dataType: 'html',
			    success: function(data) {
				  $('#viewWorksTitle').html("Works Details");
			      $('#viewWorksBoxBody').html(data); // Inject content into modal body
			    },
			    error: function(xhr, status, error) {
			      console.error("Error loading URL:", error);
			      // Handle error, display a message, etc.
			    }
			  });
			
			return false;
		}
        
        function updateUserWorksStage(estid){
        	$("#viewWorks").modal({
			    backdrop: 'static',
			    keyboard: false
			}); // Show Modal Box
			
			var url = '/gcc/works/update_works_stage_modal?estid='+estid;
			$.ajax({
			    url: url,
			    type: 'GET',
			    dataType: 'html',
			    success: function(data) {
				  $('#viewWorksTitle').html("Add Work Stage");
			      $('#viewWorksBoxBody').html(data); // Inject content into modal body
			      get_works_stage_data(estid);
			    },
			    error: function(xhr, status, error) {
			      console.error("Error loading URL:", error);
			      // Handle error, display a message, etc.
			    }
			  });
			
			return false;
		}
        
        function formatDBDate(inputDate) {
            let parts = inputDate.split("-");
            if (parts.length === 3) {
                return `${parts[2]}-${parts[1]}-${parts[0]}`; // Convert to YYYY-MM-DD
            }
            return inputDate; // Return as-is if format is incorrect
        }
        
        function updateData(){
        	let formData = new FormData();
        	
        	// Append form fields
            formData.append("estid", estid);
            formData.append("loginid", loginUserID);
         	// Append files (only if a file is selected)
         	
         	
         	let projecttype = document.getElementById("projecttype");
            let projecttypeValue = projecttype.value; // Get selected value

	         // Validate selected
	         if (!projecttypeValue) {
	             Swal.fire({
	                 title: "Error",
	                 text: "Please select a project type before submission.",
	                 icon: "error",
	                 confirmButtonText: "OK"
	             });
	             return; // Stop execution if not selected
	         }
            
	         formData.set("projecttype", projecttypeValue);
            
            let govtfund = document.getElementById("govtfund");
            let govtfundValue = govtfund.value; // Get selected value

	         // Validate selection
        	 if (!govtfundValue) {
	             Swal.fire({
	                 title: "Error",
	                 text: "Please select whether the project is government-funded before submission.",
	                 icon: "error",
	                 confirmButtonText: "OK"
	             });
	             return; // Stop execution if not selected
	         }
	      	
	        formData.set("govtfund", govtfundValue);
            
	        
         	let specialcat = document.getElementById("specialcat");
         	let specialcatValue = specialcat.value; // Get selected value

	         // Validate selection
	         if (!specialcatValue) {
	             Swal.fire({
	                 title: "Error",
	                 text: "Please select whether the project falls under a special category before submission.",
	                 icon: "error",
	                 confirmButtonText: "OK"
	             });
	             return; // Stop execution if not selected
	         }

         	// Set the form data
         	formData.set("specialcat", specialcatValue);
         	
         	
         	// Get date input values
			let techSanctionDate = $("#erptechsanctiondate").val().trim();
			let adminSanctionDate = $("#erpadminsanctiondate").val().trim();
			let tenderCallDate = $("#erptendercalldate").val().trim();
			let tenderFinalizedDate = $("#erptenderfinalizeddate").val().trim();
			
			
			
			let loaDate = $("#erploadate").val().trim();
			let agreementDate = $("#erpagreementdate").val().trim();
			let workOrderDate = $("#erpworkorderdate").val().trim();
			let workCommencedDate = $("#erpworkcommenceddate").val().trim();
			
			// Convert to Date format
		    function parseDate(dateStr) {
		        return dateStr ? new Date(dateStr.split("-").reverse().join("-")) : null;
		    }

		    let techDate = parseDate(techSanctionDate);
		    let adminDate = parseDate(adminSanctionDate);
		    let tenderDate = parseDate(tenderCallDate);
		    let finalizedDate = parseDate(tenderFinalizedDate);
		    let loa = parseDate(loaDate);
		    let agreement = parseDate(agreementDate);
		    let workOrder = parseDate(workOrderDate);
		    let workCommenced = parseDate(workCommencedDate);
		    
		    //alert(finalizedDate +">"+ tenderDate);
		    /*
		    // Validation checks
		    if (!adminDate && !techDate) {
		    	Swal.fire("Missing Dates", "Both Admin and Tech Sanction Dates are required.", "error");
		        return;
		    }
		 	*/
		 	// Parent-child dependency checks
		    if (!techDate && (adminDate || tenderDate || finalizedDate || loa || agreement || workOrder || workCommenced)) {
		        Swal.fire("Error", "Tech Sanction Date is required before entering other dates.", "error");
		        return;
		    }

		    if (!adminDate && (tenderDate || finalizedDate || loa || agreement || workOrder || workCommenced)) {
		        Swal.fire("Error", "Admin Sanction Date is required before entering Tender and later dates.", "error");
		        return;
		    }

		    if (!tenderDate && (finalizedDate || loa || agreement || workOrder)) {
		        Swal.fire("Error", "Tender Call Date is required before entering Finalized and later dates.", "error");
		        return;
		    }

		    if (!finalizedDate && (loa || agreement || workOrder)) {
		        Swal.fire("Error", "Tender Finalized Date is required before entering LOA and later dates.", "error");
		        return;
		    }

		    if (!loa && (agreement || workOrder)) {
		        Swal.fire("Error", "LOA Date is required before entering Agreement and later dates.", "error");
		        return;
		    }

		    if (!agreement && (workOrder)) {
		        Swal.fire("Error", "Agreement Date is required before entering Work Order and later dates.", "error");
		        return;
		    }
			
		    /*
		    if (!workOrder && workCommenced) {
		        Swal.fire("Error", "Work Order Date is required before entering Work Commenced Date.", "error");
		        return;
		    }
			*/
			
		    // Chronological validations
		    if (adminDate && techDate && adminDate < techDate) {
		        Swal.fire("Error", "Admin Sanction Date must be on or after Tech Sanction Date.", "error");
		        return;
		    }

		    if (tenderDate && adminDate && tenderDate < adminDate) {
		        Swal.fire("Error", "Tender Call Date must be on or after Admin Sanction Date.", "error");
		        return;
		    }

		    if (finalizedDate && tenderDate && finalizedDate < tenderDate) {
		        Swal.fire("Error", "Tender Finalized Date must be on or after Tender Call Date.", "error");
		        return;
		    }

		    if (loa && finalizedDate && loa < finalizedDate) {
		        Swal.fire("Error", "LOA Date must be on or after Tender Finalized Date.", "error");
		        return;
		    }

		    if (agreement && loa && agreement < loa) {
		        Swal.fire("Error", "Agreement Date must be on or after LOA Date.", "error");
		        return;
		    }

		    if (workOrder && agreement && workOrder <= agreement) {
		        Swal.fire("Error", "Work Order Date must be after Agreement Date.", "error");
		        return;
		    }
			/*
		    if (workCommenced && workOrder && workCommenced <= workOrder) {
		        Swal.fire("Error", "Work Commenced Date must be after Work Order Date.", "error");
		        return;
		    }
			*/	    
		    if (workCommenced && loa && workCommenced < loa) {
		        Swal.fire("Error", "Work Commenced Date must be on or after LOA Date.", "error");
		        return;
		    }
		    /*
			// Validate if all fields are filled
			if (!techSanctionDate || !adminSanctionDate || !tenderCallDate || !tenderFinalizedDate ||
    		!loaDate){
    		//|| !agreementDate || !workOrderDate || !workCommencedDate) {
			    Swal.fire({
			        title: "Error",
			        text: "All date fields are required before submission.",
			        icon: "error",
			        confirmButtonText: "OK"
			    });
			    return; // Stop execution if any date is missing
			}
			*/
			
         	// Get file inputs
		    let adminSanctionFile = $("#adminsanctionfile")[0].files[0];
		    let loaFile = $("#loafile")[0].files[0];
		    let agreementFile = $("#agreementfile")[0].files[0];
		    let workOrderFile = $("#workorderfile")[0].files[0];
			/*
		    // Validate if all files are selected
		    if (!adminSanctionFile || !loaFile || !agreementFile || !workOrderFile) {
		        Swal.fire({
		            title: "Error",
		            text: "All files are required before submission.",
		            icon: "error",
		            confirmButtonText: "OK"
		        });
		        return; // Stop execution if any file is missing
		    }
		    */
		 	// Append date to formData
		    formData.append("techSanctionDate", formatDBDate(techSanctionDate));
		    formData.append("adminSanctionDate", formatDBDate(adminSanctionDate));
		    formData.append("tenderCallDate", formatDBDate(tenderCallDate));
		    formData.append("tenderFinalizedDate", formatDBDate(tenderFinalizedDate));
		    
		 	// Append date to formData
		    formData.append("loaDate", formatDBDate(loaDate));
		    formData.append("agreementDate", formatDBDate(agreementDate));
		    formData.append("workOrderDate", formatDBDate(workOrderDate));
		    formData.append("workCommencedDate", formatDBDate(workCommencedDate));
		    
		 	// Append files to formData
		 	if(adminSanctionFile){
		 		formData.append("admin_sanction_file", adminSanctionFile);
			}
		 	if(loaFile){
		    	formData.append("loa_file", loaFile);
		 	}
		 	if(agreementFile){
		    	formData.append("agreement_file", agreementFile);
		 	}
		 	if(workOrderFile){
		    	formData.append("work_order_file", workOrderFile);
		 	}
            
            let iconicProjectCheckbox = document.getElementById("isiconic");
            let iconicProjectValue = iconicProjectCheckbox.checked ? "1" : "0"; // Set 1 if checked, else 0
            formData.set("isiconic", iconicProjectValue);
            
            $.ajax({
                url: "/gcc/works/api/estimates/updateEstimateWorkDetails",
                type: "POST",
                contentType: false,
                processData: false,
                data: formData,
                success: function (response) {
                    // console.log(formData);
                    Swal.fire({
                        title: "Updated!",
                        text: "Estimate details have been updated successfully.",
                        icon: "success",
                        confirmButtonText: "OK",
                    }).then(() => {
                        location.reload();
                    });
                },
                error: function (xhr, status, error) {
                    // console.log(xhr.responseText);
                    Swal.fire({
                        title: "Error",
                        text: "Failed to update estimate." + "Error: " + error + "\nStatus: " + status + "\nResponse: " + xhr.responseText,
                        icon: "error",
                        confirmButtonText: "OK",
                    });
                }
            });
        	
        }
        
        /*
        	===============================================================
        */
        
        $(document).ready(function () {
			
        	/*
        	=================================
        	*/
        	//call_loading();
            //loadWardsFilter();
            //loadDepartmentFilter();
            //loadSourceFilter();
            get_erp_works_data_list();
        });
        
    </script>
</body>

</html>